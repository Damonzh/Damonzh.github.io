<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>DamonZhang</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="title: 使用Transition FrameWork实现有意义的转场动画(译)date: 2016-4-4 16:32:45  
tags: [Android, 译文]原文  
Android Transition Framework可以实现三种效果:  

不同Activity之间切换时,Activityc的内容(contentView)转场动画
不同Activity之间切换时，如果使用了">
<meta property="og:type" content="article">
<meta property="og:title" content="DamonZhang">
<meta property="og:url" content="http://yoursite.com/2016/04/04/transition-framework/index.html">
<meta property="og:site_name" content="DamonZhang">
<meta property="og:description" content="title: 使用Transition FrameWork实现有意义的转场动画(译)date: 2016-4-4 16:32:45  
tags: [Android, 译文]原文  
Android Transition Framework可以实现三种效果:  

不同Activity之间切换时,Activityc的内容(contentView)转场动画
不同Activity之间切换时，如果使用了">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_A_to_B.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_explode.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_slide.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_B_to_A.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade2.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element.png">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_anim.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_no_overlap.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_overlap.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_no_overlap.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/scenes_anim.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/view_layout_anim.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_reveal_anim.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/reveal_green.gif">
<meta property="og:image" content="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/reveal_red.gif">
<meta property="og:updated_time" content="2016-04-04T08:44:55.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="DamonZhang">
<meta name="twitter:description" content="title: 使用Transition FrameWork实现有意义的转场动画(译)date: 2016-4-4 16:32:45  
tags: [Android, 译文]原文  
Android Transition Framework可以实现三种效果:  

不同Activity之间切换时,Activityc的内容(contentView)转场动画
不同Activity之间切换时，如果使用了">
  
  
    <link rel="icon" href="/img/avatar.png">
  
  <link rel="stylesheet" href="/css/style.css" type="text/css">
</head>
<body>
  <div id="container">
    <div class="left-col">
    <div class="overlay"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			
			<img lazy-src="/img/avatar.png" class="js-avatar">
			
		</a>

		<hgroup>
		  <h1 class="header-author"><a href="/">Damon Zhang</a></h1>
		</hgroup>

		
		<p class="header-subtitle">每天进步,持之以恒</p>
		

		
			<div class="switch-btn">
				<div class="icon">
					<div class="icon-ctn">
						<div class="icon-wrap icon-house" data-idx="0">
							<div class="birdhouse"></div>
							<div class="birdhouse_holes"></div>
						</div>
						<div class="icon-wrap icon-ribbon hide" data-idx="1">
							<div class="ribbon"></div>
						</div>
						
						
					</div>
					
				</div>
				<div class="tips-box hide">
					<div class="tips-arrow"></div>
					<ul class="tips-inner">
						<li>菜单</li>
						<li>标签</li>
						
						
					</ul>
				</div>
			</div>
		

		<div class="switch-area">
			<div class="switch-wrap">
				<section class="switch-part switch-part1">
					<nav class="header-menu">
						<ul>
						
							<li><a href="/">主页</a></li>
				        
							<li><a href="/archives">所有文章</a></li>
				        
						</ul>
					</nav>
					<nav class="header-nav">
						<div class="social">
							
						</div>
					</nav>
				</section>
				
				
				<section class="switch-part switch-part2">
					<div class="widget tagcloud" id="js-tagcloud">
						<a href="/tags/Android/" style="font-size: 20px;">Android</a> <a href="/tags/AnimatedVectorDrawable/" style="font-size: 10px;">AnimatedVectorDrawable</a> <a href="/tags/EventBus/" style="font-size: 13.33px;">EventBus</a> <a href="/tags/Gradle/" style="font-size: 16.67px;">Gradle</a> <a href="/tags/Handler/" style="font-size: 10px;">Handler</a> <a href="/tags/Toolbar/" style="font-size: 13.33px;">Toolbar</a> <a href="/tags/VectorDrawable/" style="font-size: 10px;">VectorDrawable</a> <a href="/tags/微信支付/" style="font-size: 10px;">微信支付</a> <a href="/tags/源码/" style="font-size: 13.33px;">源码</a> <a href="/tags/译文/" style="font-size: 16.67px;">译文</a>
					</div>
				</section>
				
				
				

				
			</div>
		</div>
	</header>				
</div>
    </div>
    <div class="mid-col">
      <nav id="mobile-nav">
  	<div class="overlay">
  		<div class="slider-trigger"></div>
  		<h1 class="header-author js-mobile-header hide">Damon Zhang</h1>
  	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img lazy-src="/img/avatar.png" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author">Damon Zhang</h1>
			</hgroup>
			
			<p class="header-subtitle">每天进步,持之以恒</p>
			
			<nav class="header-menu">
				<ul>
				
					<li><a href="/">主页</a></li>
		        
					<li><a href="/archives">所有文章</a></li>
		        
		        <div class="clearfix"></div>
				</ul>
			</nav>
			<nav class="header-nav">
				<div class="social">
					
				</div>
			</nav>
		</header>				
	</div>
</nav>
      <div class="body-wrap"><article id="post-transition-framework" class="article article-type-post" itemscope itemprop="blogPost">
  
    <div class="article-meta">
      <a href="/2016/04/04/transition-framework/" class="article-date">
  	<time datetime="2016-04-04T08:44:55.000Z" itemprop="datePublished">2016-04-04</time>
</a>
    </div>
  
  <div class="article-inner">
    
      <input type="hidden" class="isFancy" />
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>title: 使用Transition FrameWork实现有意义的转场动画(译)<br>date: 2016-4-4 16:32:45  </p>
<h2 id="tags_3A__5BAndroid_2C__u8BD1_u6587_5D"><a href="#tags_3A__5BAndroid_2C__u8BD1_u6587_5D" class="headerlink" title="tags: [Android, 译文]"></a>tags: [Android, 译文]</h2><p><a href="https://github.com/lgvalle/Material-Animations/blob/master/README.md" target="_blank" rel="external">原文</a>  </p>
<p>Android Transition Framework可以实现三种效果:  </p>
<ol>
<li>不同Activity之间切换时,Activityc的内容(contentView)转场动画</li>
<li>不同Activity之间切换时，如果使用了Shared Element动画，也可以使用Transition FrameWork来实现不同的过渡动画效果</li>
<li>同一个Activity内View变化的过渡动画(Scene)  </li>
</ol>
<h2 id="1-_Activity_u4E4B_u95F4_u5207_u6362_u7684_u8FC7_u6E21_u52A8_u753B"><a href="#1-_Activity_u4E4B_u95F4_u5207_u6362_u7684_u8FC7_u6E21_u52A8_u753B" class="headerlink" title="1. Activity之间切换的过渡动画"></a>1. Activity之间切换的过渡动画</h2><p>通过这种方法可以使activity切换时，他们的布局内容有过度动画  </p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_A_to_B.png" alt="">  </p>
<p>当从<code>Activity A</code>切换到<code>Activity B</code>的时候，Activity布局的内容会按照预先定义好的动画来执行过渡动画。在<code>android.transition</code>包中，已经有三种现成的动画可以用:<strong>Explode，Slide和Fade。</strong>所有这些过渡都会跟踪activity布局中可见的目标Views，驱动这些Views按照过渡的规则产生响应的动画效果。  </p>
<table>
<thead>
<tr>
<th>Explode</th>
<th>Explode</th>
<th>Explode</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_explode.gif" alt=""></td>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_slide.gif" alt=""></td>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade.gif" alt="">  </td>
</tr>
</tbody>
</table>
<p>你可以在xml中创建这些过渡效果，也可以通过代码来创建。对于Fade过渡效果来说，它看起来是这样子的：  </p>
<h3 id="xml_u4E2D_u521B_u5EFA"><a href="#xml_u4E2D_u521B_u5EFA" class="headerlink" title="xml中创建"></a>xml中创建</h3><p>过渡效果定义在xml中，目录是<code>res/transition</code></p>
<blockquote>
<p>res/transition/activity_fade.xml  </p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">fade</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/"</span></span><br><span class="line">    <span class="attribute">android:duration</span>=<span class="value">"1000"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>res/transition/activity_slide.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="pi">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="title">slide</span> <span class="attribute">xmlns:android</span>=<span class="value">"http://schemas.android.com/apk/res/"</span></span><br><span class="line">    <span class="attribute">android:duration</span>=<span class="value">"1000"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
<p>要使用这些xml’中定义的过渡动画，你需要使用<code>TransitionInflater</code>来实例化它们。</p>
<blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_transition);</span><br><span class="line">       setupWindowAnimations();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupWindowAnimations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Slide slide = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.activity_slide);</span><br><span class="line">       getWindow().setExitTransition(slide);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TransitionActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_transition);</span><br><span class="line">       setupWindowAnimations();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupWindowAnimations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Fade fade = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.activity_fade);</span><br><span class="line">       getWindow().setEnterTransition(fade);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h3 id="u5728_u4EE3_u7801_u4E2D_u521B_u5EFA"><a href="#u5728_u4EE3_u7801_u4E2D_u521B_u5EFA" class="headerlink" title="在代码中创建"></a>在代码中创建</h3><blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_transition);</span><br><span class="line">       setupWindowAnimations();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupWindowAnimations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Slide slide = <span class="keyword">new</span> Slide();</span><br><span class="line">       slide.setDuration(<span class="number">1000</span>);</span><br><span class="line">       getWindow().setExitTransition(slide);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>TransitionActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_transition);</span><br><span class="line">       setupWindowAnimations();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupWindowAnimations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Fade fade = <span class="keyword">new</span> Fade();</span><br><span class="line">       fade.setDuration(<span class="number">1000</span>);</span><br><span class="line">       getWindow().setEnterTransition(fade);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<h4 id="u4E0D_u7BA1_u54EA_u79CD_u521B_u5EFA_u65B9_u6CD5_u90FD_u4F1A_u4EA7_u751F_u5982_u4E0B_u7684_u6548_u679C_3A"><a href="#u4E0D_u7BA1_u54EA_u79CD_u521B_u5EFA_u65B9_u6CD5_u90FD_u4F1A_u4EA7_u751F_u5982_u4E0B_u7684_u6548_u679C_3A" class="headerlink" title="不管哪种创建方法都会产生如下的效果:"></a>不管哪种创建方法都会产生如下的效果:</h4><p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade.gif" alt="transition_fade"></p>
<h3 id="u90A3_u4E48_u8FD9_u91CC_u9762_u4E00_u6B65_u4E00_u6B65_u7684_u5230_u5E95_u53D1_u751F_u4E86_u4EC0_u4E48_3A"><a href="#u90A3_u4E48_u8FD9_u91CC_u9762_u4E00_u6B65_u4E00_u6B65_u7684_u5230_u5E95_u53D1_u751F_u4E86_u4EC0_u4E48_3A" class="headerlink" title="那么这里面一步一步的到底发生了什么:"></a>那么这里面一步一步的到底发生了什么:</h3><ol>
<li><p>Activity A 启动 Activity B</p>
</li>
<li><p>Transition Framework 发现 A 中定义了Exit Transition (slide) 然后就会对它的所有可见的View使用这个过渡动画.</p>
</li>
<li>Transition Framework 发现 B 中定义了Enter Transition (fade) 然后机会对它所有可见的Views使用这个过渡动画.</li>
<li><strong>On Back Pressed(按返回键)</strong> Transition Framework 会执行把 Enter and Exit过渡动画反过来执行(但是如果定义了 <code>returnTransition</code>和<code>reenterTransition</code>,那么就会执行这些定义的动画)</li>
</ol>
<p><strong>译注:</strong>  </p>
<ul>
<li>Exit Transition:可以理解为activity进入后台的过渡动画</li>
<li>Enter Transition:可以理解为创建activity并显示时的过渡动画</li>
<li>Return Transition:可以理解为销毁activity时的过渡动画</li>
<li>Reenter Transition:可以理解为activity从后台进入前台时的过渡动画</li>
<li>要使这些过渡动画生效，我们需要调用<code>startActivity(intent，bundle)</code>方法来启动activity。<code>bundle</code>需要通过<code>ActivityOptionsCompat.makeSceneTransitionAnimation().toBundle()</code>的方式来生成</li>
</ul>
<h3 id="ReturnTransition__26amp_3B_ReenterTransition"><a href="#ReturnTransition__26amp_3B_ReenterTransition" class="headerlink" title="ReturnTransition &amp; ReenterTransition"></a>ReturnTransition &amp; ReenterTransition</h3><p>Return and Reenter Transitions是与进入和退出动画相对应的.</p>
<ul>
<li>EnterTransition &lt;–&gt; ReturnTransition</li>
<li>ExitTransition &lt;–&gt; ReenterTransition</li>
</ul>
<p>如果Return or Reenter没有创建, Android 会把Enter and Exit Transitions反过来执行. 但是如果你创建了Return or Reenter，那Android就会执行你创建的动画，并且这些动画可以不同.</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_B_to_A.png" alt="b back a"></p>
<p>我们可以修改下前面Fade的例子，给 <code>TransitionActivity</code>创建 <code>ReturnTransition</code>。这里我们就拿<strong>Slide</strong>过渡效果来举例子。这样，如果我们从B返回到A的时候，B就会执行一个Slide的过渡效果。  </p>
<blockquote>
<p>TransitionActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">super</span>.onCreate(savedInstanceState);</span><br><span class="line">       setContentView(R.layout.activity_transition);</span><br><span class="line">       setupWindowAnimations();</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setupWindowAnimations</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       Fade fade = <span class="keyword">new</span> Fade();</span><br><span class="line">       fade.setDuration(<span class="number">1000</span>);</span><br><span class="line">       getWindow().setEnterTransition(fade);</span><br><span class="line">       </span><br><span class="line">       Slide slide = <span class="keyword">new</span> Slide();</span><br><span class="line">       slide.setDuration(<span class="number">1000</span>);</span><br><span class="line">       getWindow().setReturnTransition(slide);        </span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到，如果没有创建Return Transition，退出的时候会执行Enter Transtion相反的动画。如果创建了Return Transition，那么就会执行这个创建的动画效果。</p>
<table>
<thead>
<tr>
<th>没有Return Transition</th>
<th>有Return Transition </th>
</tr>
</thead>
<tbody>
<tr>
<td>Enter: <code>Fade In</code></td>
<td>Enter: <code>Fade In</code></td>
</tr>
<tr>
<td>Exit: <code>Fade Out</code></td>
<td>Exit: <code>Slide out</code></td>
</tr>
<tr>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade.gif" alt="transition_fade"></td>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/transition_fade2.gif" alt="transition_fade2"> </td>
</tr>
</tbody>
</table>
<h2 id="2-_Activity_u4E4B_u95F4_u5171_u4EAB_u5143_u7D20_28Share_Elements_29"><a href="#2-_Activity_u4E4B_u95F4_u5171_u4EAB_u5143_u7D20_28Share_Elements_29" class="headerlink" title="2. Activity之间共享元素(Share Elements)"></a>2. Activity之间共享元素(Share Elements)</h2><p>这里的思想就是通过动画的形式将两个不同布局中的两个不同的View联系起来。<br>然后Transition framework就会在用户从一个View切换到另一个View的时候给用户展现一些必要的动画。<br>但你要记住:发生动画的View并不是从一个布局中移动到另一个布局。他们是两个独立的View。</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element.png" alt="A Start B with shared"></p>
<h3 id="a_29__u8BBE_u7F6EWindow_Content_Transition_u5C5E_u6027"><a href="#a_29__u8BBE_u7F6EWindow_Content_Transition_u5C5E_u6027" class="headerlink" title="a) 设置Window Content Transition属性"></a>a) 设置Window Content Transition属性</h3><p>你需要在app的 <code>styles.xml</code>中进行设置.[译]我没有设置也没问题</p>
<blockquote>
<p>values/styles.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"MaterialAnimations"</span> <span class="attribute">parent</span>=<span class="value">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">    ...</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">android</span><span class="pseudo">:windowContentTransitions"</span>&gt;<span class="tag">true</span>&lt;/<span class="tag">item</span></span><br><span class="line">    ...</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>如果你愿意的话，你也可以给整个app设置一个默认的转场动画和共享元素动画。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"MaterialAnimations"</span> <span class="attribute">parent</span>=<span class="value">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">    ...</span><br><span class="line">    &lt;!<span class="tag">--</span> <span class="tag">specify</span> <span class="tag">enter</span> <span class="tag">and</span> <span class="tag">exit</span> <span class="tag">transitions</span> <span class="tag">--</span>&gt;</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">android</span><span class="pseudo">:windowEnterTransition"</span>&gt;<span class="at_rule">@<span class="keyword">transition/explode&lt;/item&gt;</span></span><br><span class="line">    &lt;item name=<span class="string">"android:windowExitTransition"</span>&gt;@transition/explode&lt;/item&gt;</span><br><span class="line"></span><br><span class="line">    &lt;!-- specify shared element transitions --&gt;</span><br><span class="line">    &lt;item name=<span class="string">"android:windowSharedElementEnterTransition"</span>&gt;@transition/changebounds&lt;/item&gt;</span><br><span class="line">    &lt;item name=<span class="string">"android:windowSharedElementExitTransition"</span>&gt;@transition/changebounds&lt;/item&gt;</span><br><span class="line">    ...</span><br><span class="line"></span></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="b_29_u8BBE_u7F6E_u76F8_u540C_u7684transition_name"><a href="#b_29_u8BBE_u7F6E_u76F8_u540C_u7684transition_name" class="headerlink" title="b)设置相同的transition name"></a>b)设置相同的transition name</h3><p>为了使共享元素动画生效，你需要给共享元素的两个View设置相同的<code>android:transitionName</code>属性值。不过他们的id和其他属性可以不同。</p>
<blockquote>
<p>layout/activity_a.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/small_blue_icon"</span></span><br><span class="line">        <span class="attribute">style</span>=<span class="value">"@style/MaterialAnimations.Icon.Small"</span></span><br><span class="line">        <span class="attribute">android:src</span>=<span class="value">"@drawable/circle"</span></span><br><span class="line">        <span class="attribute">android:transitionName</span>=<span class="value">"@string/blue_name"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>layout/activity_b.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/big_blue_icon"</span></span><br><span class="line">        <span class="attribute">style</span>=<span class="value">"@style/MaterialAnimations.Icon.Big"</span></span><br><span class="line">        <span class="attribute">android:src</span>=<span class="value">"@drawable/circle"</span></span><br><span class="line">        <span class="attribute">android:transitionName</span>=<span class="value">"@string/blue_name"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="c_29__u7528_u5171_u4EAB_u5143_u7D20_u6765_u542F_u52A8activity"><a href="#c_29__u7528_u5171_u4EAB_u5143_u7D20_u6765_u542F_u52A8activity" class="headerlink" title="c) 用共享元素来启动activity"></a>c) 用共享元素来启动activity</h3><p>使用<code>ActivityOptions.makeSceneTransitionAnimation()</code> 方法指定要共享元素的View和<code>android:transitionName</code>属性的值</p>
<blockquote>
<p>MainActivity.java</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">blueIconImageView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">        Intent i = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, SharedElementActivity.class);</span><br><span class="line"></span><br><span class="line">        View sharedView = blueIconImageView;</span><br><span class="line">        String transitionName = getString(R.string.blue_name);</span><br><span class="line"></span><br><span class="line">        ActivityOptions transitionActivityOptions = ActivityOptions.makeSceneTransitionAnimation(MainActivity.<span class="keyword">this</span>, sharedView, transitionName);</span><br><span class="line">        startActivity(i, transitionActivityOptions.toBundle());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>这样就可以有下面漂亮的过渡效果了:</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_anim.gif" alt="a to b with shared element"></p>
<p>可以看到, Transition framework 创建并执行了一个动画。动画的视觉效果就是一个View从一个activity移动到另一个activity中并伴随着形状的变化。</p>
<h2 id="u5728fragment_u4E4B_u95F4_u5B9E_u73B0Shared_elements_u8FC7_u6E21_u52A8_u753B"><a href="#u5728fragment_u4E4B_u95F4_u5B9E_u73B0Shared_elements_u8FC7_u6E21_u52A8_u753B" class="headerlink" title="在fragment之间实现Shared elements过渡动画"></a>在fragment之间实现Shared elements过渡动画</h2><p>这个activity中的做法几乎是一样的。 </p>
<p><strong>a)</strong> 和<strong>b)</strong>完全一样， 只有<strong>c)</strong>有点区别            </p>
<h3 id="a_29__u8BBE_u7F6EWindow_Content_Transition_u5C5E_u6027-1"><a href="#a_29__u8BBE_u7F6EWindow_Content_Transition_u5C5E_u6027-1" class="headerlink" title="a) 设置Window Content Transition属性"></a>a) 设置Window Content Transition属性</h3><blockquote>
<p>values/styles.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">style</span> <span class="attribute">name</span>=<span class="value">"MaterialAnimations"</span> <span class="attribute">parent</span>=<span class="value">"@style/Theme.AppCompat.Light.NoActionBar"</span>&gt;</span><span class="css"></span><br><span class="line">    ...</span><br><span class="line">    &lt;<span class="tag">item</span> <span class="tag">name</span>="<span class="tag">android</span><span class="pseudo">:windowContentTransitions"</span>&gt;<span class="tag">true</span>&lt;/<span class="tag">item</span>&gt;</span><br><span class="line">    ...</span><br><span class="line"></span><span class="tag">&lt;/<span class="title">style</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="b_29__u8BBE_u7F6E_u76F8_u540C_u7684transition_name"><a href="#b_29__u8BBE_u7F6E_u76F8_u540C_u7684transition_name" class="headerlink" title="b) 设置相同的transition name"></a>b) 设置相同的transition name</h3><blockquote>
<p>layout/fragment_a.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/small_blue_icon"</span></span><br><span class="line">        <span class="attribute">style</span>=<span class="value">"@style/MaterialAnimations.Icon.Small"</span></span><br><span class="line">        <span class="attribute">android:src</span>=<span class="value">"@drawable/circle"</span></span><br><span class="line">        <span class="attribute">android:transitionName</span>=<span class="value">"@string/blue_name"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>layout/fragment_b.xml</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="title">ImageView</span></span><br><span class="line">        <span class="attribute">android:id</span>=<span class="value">"@+id/big_blue_icon"</span></span><br><span class="line">        <span class="attribute">style</span>=<span class="value">"@style/MaterialAnimations.Icon.Big"</span></span><br><span class="line">        <span class="attribute">android:src</span>=<span class="value">"@drawable/circle"</span></span><br><span class="line">        <span class="attribute">android:transitionName</span>=<span class="value">"@string/blue_name"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="c_29__u542F_u52A8_u5E26_u6709_u5171_u4EAB_u5143_u7D20_u7684fragment"><a href="#c_29__u542F_u52A8_u5E26_u6709_u5171_u4EAB_u5143_u7D20_u7684fragment" class="headerlink" title="c) 启动带有共享元素的fragment"></a>c) 启动带有共享元素的fragment</h3><p>在你使用<strong><code>FragmentTransaction</code></strong>启动fragment的时候，你需要同时带上共享元素过渡动画的先关信息。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">FragmentB fragmentB = FragmentB.newInstance(sample);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Defines enter transition for all fragment views</span></span><br><span class="line">Slide slideTransition = <span class="keyword">new</span> Slide(Gravity.RIGHT);</span><br><span class="line">slideTransition.setDuration(<span class="number">1000</span>);</span><br><span class="line">sharedElementFragment2.setEnterTransition(slideTransition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Defines enter transition only for shared element</span></span><br><span class="line">ChangeBounds changeBoundsTransition = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.change_bounds);</span><br><span class="line">fragmentB.setSharedElementEnterTransition(changeBoundsTransition);</span><br><span class="line"></span><br><span class="line">getFragmentManager().beginTransaction()</span><br><span class="line">        .replace(R.id.content, fragmentB)</span><br><span class="line">        .addSharedElement(blueView, getString(R.string.blue_name))</span><br><span class="line">        .commit();</span><br></pre></td></tr></table></figure>
<p>最终的效果就是这样的:</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_no_overlap.gif" alt="shared_element_no_overlap"></p>
<h2 id="u5141_u8BB8_u8FC7_u6E21_u6548_u679C_u4E4B_u95F4_u7684_u91CD_u53E0"><a href="#u5141_u8BB8_u8FC7_u6E21_u6548_u679C_u4E4B_u95F4_u7684_u91CD_u53E0" class="headerlink" title="允许过渡效果之间的重叠"></a>允许过渡效果之间的重叠</h2><p>You can define if enter and exit transitions can overlap each other.<br>你可以设置一个activity的退出效果和另一个activity的进入效果产生重叠部分。</p>
<p><a href="http://developer.android.com/intl/ko/reference/android/app/Fragment.html#getAllowEnterTransitionOverlap(" target="_blank" rel="external">Android文档</a>)这么说的:</p>
<blockquote>
<p>当设置为<strong>true</strong>,enter transition会立马执行&gt;<br>当设置为<strong>false</strong>,enter transition会等到退出exit transition结束后再执行.</p>
</blockquote>
<p>这对Fragments和Activities的共享元素过渡效果都是有用的。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">FragmentB fragmentB = FragmentB.newInstance(sample);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Defines enter transition for all fragment views</span></span><br><span class="line">Slide slideTransition = <span class="keyword">new</span> Slide(Gravity.RIGHT);</span><br><span class="line">slideTransition.setDuration(<span class="number">1000</span>);</span><br><span class="line">sharedElementFragment2.setEnterTransition(slideTransition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Defines enter transition only for shared element</span></span><br><span class="line">ChangeBounds changeBoundsTransition = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.change_bounds);</span><br><span class="line">fragmentB.setSharedElementEnterTransition(changeBoundsTransition);</span><br><span class="line"></span><br><span class="line"><span class="comment">// Prevent transitions for overlapping</span></span><br><span class="line">fragmentB.setAllowEnterTransitionOverlap(overlap);</span><br><span class="line">fragmentB.setAllowReturnTransitionOverlap(overlap);</span><br><span class="line"></span><br><span class="line">getFragmentManager().beginTransaction()</span><br><span class="line">        .replace(R.id.content, fragmentB)</span><br><span class="line">        .addSharedElement(blueView, getString(R.string.blue_name))</span><br><span class="line">        .commit();</span><br></pre></td></tr></table></figure>
<p>可以看到，效果还是挺明显的:</p>
<table>
<thead>
<tr>
<th>Overlap True</th>
<th>Overlap False</th>
</tr>
</thead>
<tbody>
<tr>
<td>Fragment_2 出现在Fragment_1的上面</td>
<td>Fragment_2 等到Fragment_1消失后才出现</td>
</tr>
<tr>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_overlap.gif" alt="shared_element_overlap"></td>
<td><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_element_no_overlap.gif" alt="shared_element_no_overlap"></td>
</tr>
</tbody>
</table>
<h2 id="3-__u5E03_u5C40_u5143_u7D20_u52A8_u753B"><a href="#3-__u5E03_u5C40_u5143_u7D20_u52A8_u753B" class="headerlink" title="3. 布局元素动画"></a>3. 布局元素动画</h2><h3 id="Scenes"><a href="#Scenes" class="headerlink" title="Scenes"></a>Scenes</h3><p>也可以用来驱动一个activity中的布局发生变化时，让其中的View产生过渡动画。</p>
<p>过渡效果发生在场景之间。场景就是一个定义了静态UI的普通布局。Transition Framework可以在两个场景之间添加切换过渡动画。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">scene1 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene1, <span class="keyword">this</span>);</span><br><span class="line">scene2 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene2, <span class="keyword">this</span>);</span><br><span class="line">scene3 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene3, <span class="keyword">this</span>);</span><br><span class="line">scene4 = Scene.getSceneForLayout(sceneRoot, R.layout.activity_animations_scene4, <span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">(...)</span><br><span class="line"></span><br><span class="line"><span class="annotation">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">switch</span> (v.getId()) &#123;</span><br><span class="line">        <span class="keyword">case</span> R.id.button1:</span><br><span class="line">            TransitionManager.go(scene1, <span class="keyword">new</span> ChangeBounds());</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.button2:</span><br><span class="line">            TransitionManager.go(scene2, TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.slide_and_changebounds));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.button3:</span><br><span class="line">            TransitionManager.go(scene3, TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.slide_and_changebounds_sequential));</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> R.id.button4:</span><br><span class="line">            TransitionManager.go(scene4, TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.slide_and_changebounds_sequential_with_interpolators));</span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码会在同一个activity中的4个场景切换时产生过渡动画。每一次切花的动画都是不一样的。</p>
<p>Transition Framework会考虑当前场景内所有可见的View并计算需出需要的动画来安排两个场景之间的view的位置。</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/scenes_anim.gif" alt="scenes_anim"></p>
<h3 id="u5E03_u5C40_u7684_u6539_u53D8"><a href="#u5E03_u5C40_u7684_u6539_u53D8" class="headerlink" title="布局的改变"></a>布局的改变</h3><p>也可以用来给布局属性的变化加上过渡效果。你只需要做你想要的改变然后其他的就交给Transition Framework，它会为你添加动画。</p>
<h4 id="a_29__u5F00_u542F_u6F14_u793A_u8FC7_u6E21_u6548_u679C"><a href="#a_29__u5F00_u542F_u6F14_u793A_u8FC7_u6E21_u6548_u679C" class="headerlink" title="a) 开启演示过渡效果"></a>a) 开启演示过渡效果</h4><p>下面这行代码告诉framework我们将要对UI进行一些改变，请你给我加上过渡效果。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">TransitionManager.beginDelayedTransition(sceneRoot);</span><br></pre></td></tr></table></figure>
<h4 id="b_29__u6539_u53D8_u5E03_u5C40_u53C2_u6570"><a href="#b_29__u6539_u53D8_u5E03_u5C40_u53C2_u6570" class="headerlink" title="b) 改变布局参数"></a>b) 改变布局参数</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ViewGroup.LayoutParams params = greenIconView.getLayoutParams();</span><br><span class="line">params.width = <span class="number">200</span>;</span><br><span class="line">greenIconView.setLayoutParams(params);</span><br></pre></td></tr></table></figure>
<p>改变View的宽度属性让他变小，这会触发<code>layoutMeasure</code>。这个点上，Transition framework会记录开始和结束时的相关值，并给这个变化加上过渡效果。</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/view_layout_anim.gif" alt="view layout animation"></p>
<h2 id="4-__28_u5F69_u86CB_29__u5171_u4EAB_u5143_u7D20_28share_elements_29+_u5706_u5F62_u5C55_u73B0_28Circular_Reveal_29"><a href="#4-__28_u5F69_u86CB_29__u5171_u4EAB_u5143_u7D20_28share_elements_29+_u5706_u5F62_u5C55_u73B0_28Circular_Reveal_29" class="headerlink" title="4. (彩蛋) 共享元素(share elements)+圆形展现(Circular Reveal)"></a>4. (彩蛋) 共享元素(share elements)+圆形展现(Circular Reveal)</h2><p>圆形展现仅仅一个现实和隐藏一组view的动画而已。API21+可以通过<code>ViewAnimationUtils</code>来使用它。</p>
<p>Circular Reveal动画可以结合共享元素过渡效果来创建一些有意义的动画来告诉用户app在发生中什么。</p>
<p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/shared_reveal_anim.gif" alt="reveal_shared_anim"></p>
<p>这又是怎么回事呢:</p>
<ul>
<li>橙色的圆是发生在<code>MainActivity</code> 和<code>RevealActivity</code>之间的共享元素动画。</li>
<li>在<code>RevealActivity</code>中有一个共享元素动画结束的监听器。当动画结束时它做了两件事：<ul>
<li>给Toolbar执行一个Circular Reveal动画</li>
<li>使用<code>ViewPropertyAnimator</code>给<code>RevealActivity</code>的其他View执行一个放大的动画</li>
</ul>
</li>
</ul>
<blockquote>
<p>监听共享元素动画的结束</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">Transition transition = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.changebounds_with_arcmotion);</span><br><span class="line">getWindow().setSharedElementEnterTransition(transition);</span><br><span class="line">transition.addListener(<span class="keyword">new</span> Transition.TransitionListener() &#123;</span><br><span class="line">    <span class="annotation">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionEnd</span><span class="params">(Transition transition)</span> </span>&#123;</span><br><span class="line">        animateRevealShow(toolbar);</span><br><span class="line">        animateButtonsIn();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    (...)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<blockquote>
<p>显示Toolbar</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">animateRevealShow</span><span class="params">(View viewRoot)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> cx = (viewRoot.getLeft() + viewRoot.getRight()) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> cy = (viewRoot.getTop() + viewRoot.getBottom()) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">int</span> finalRadius = Math.max(viewRoot.getWidth(), viewRoot.getHeight());</span><br><span class="line"></span><br><span class="line">    Animator anim = ViewAnimationUtils.createCircularReveal(viewRoot, cx, cy, <span class="number">0</span>, finalRadius);</span><br><span class="line">    viewRoot.setVisibility(View.VISIBLE);</span><br><span class="line">    anim.setDuration(<span class="number">1000</span>);</span><br><span class="line">    anim.setInterpolator(<span class="keyword">new</span> AccelerateInterpolator());</span><br><span class="line">    anim.start();</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line"></span><br><span class="line">&gt; 放大activity的内部view  </span><br><span class="line"></span><br><span class="line">```<span class="function">java</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">animateButtonsIn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bgViewGroup.getChildCount(); i++) &#123;</span><br><span class="line">        View child = bgViewGroup.getChildAt(i);</span><br><span class="line">        child.animate()</span><br><span class="line">                .setStartDelay(<span class="number">100</span> + i * DELAY)</span><br><span class="line">                .setInterpolator(interpolator)</span><br><span class="line">                .alpha(<span class="number">1</span>)</span><br><span class="line">                .scaleX(<span class="number">1</span>)</span><br><span class="line">                .scaleY(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="u66F4_u591Acircular_reveal_u52A8_u753B"><a href="#u66F4_u591Acircular_reveal_u52A8_u753B" class="headerlink" title="更多circular reveal动画"></a>更多circular reveal动画</h3><p>有很多种方式来实现一个view的显示动画，但重要的是要让这些动画有意义，它可以告诉用户app中正在发生着什么。</p>
<h4 id="u4ECE_u76EE_u6807View_u7684_u4E2D_u95F4_u4EA7_u751F_u4E00_u4E2ACircular_Reveal_u52A8_u753B"><a href="#u4ECE_u76EE_u6807View_u7684_u4E2D_u95F4_u4EA7_u751F_u4E00_u4E2ACircular_Reveal_u52A8_u753B" class="headerlink" title="从目标View的中间产生一个Circular Reveal动画"></a>从目标View的中间产生一个Circular Reveal动画</h4><p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/reveal_green.gif" alt="reveal_green"></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">int cx = (viewRoot.getLeft() + viewRoot.getRight()) / 2;</span><br><span class="line">int cy = viewRoot.getTop();</span><br><span class="line">int finalRadius = Math.max(viewRoot.getWidth(), viewRoot.getHeight());</span><br><span class="line"></span><br><span class="line">Animator anim = ViewAnimationUtils.createCircularReveal(viewRoot, cx, cy, 0, finalRadius);</span><br><span class="line">viewRoot.setBackgroundColor(color);</span><br><span class="line">anim.start();</span><br><span class="line">```        </span><br><span class="line"></span><br><span class="line">#### 从目标View的顶部产生一个Circular Reveal动画并且结合了其他的动画</span><br><span class="line"></span><br><span class="line">![reveal_blue]</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">int cx = (viewRoot.getLeft() + viewRoot.getRight()) / 2;</span><br><span class="line">int cy = (viewRoot.getTop() + viewRoot.getBottom()) / 2;</span><br><span class="line">int finalRadius = Math.max(viewRoot.getWidth(), viewRoot.getHeight());</span><br><span class="line"></span><br><span class="line">Animator anim = ViewAnimationUtils.createCircularReveal(viewRoot, cx, cy, 0, finalRadius);</span><br><span class="line">viewRoot.setBackgroundColor(color);</span><br><span class="line">anim.addListener(new AnimatorListenerAdapter() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onAnimationEnd(Animator animation) &#123;</span><br><span class="line">        animateButtonsIn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line">anim.start();</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">#### 从触摸点产生一个Circular Reveal动画</span><br><span class="line"></span><br><span class="line">![reveal_yellow]</span><br><span class="line"></span><br><span class="line">```java</span><br><span class="line">@Override</span><br><span class="line">public boolean onTouch(View view, MotionEvent motionEvent) &#123;</span><br><span class="line">    if (motionEvent.getAction() == MotionEvent.ACTION_DOWN) &#123;</span><br><span class="line">        if (view.getId() == R.id.square_yellow) &#123;</span><br><span class="line">            revealFromCoordinates(motionEvent.getRawX(), motionEvent.getRawY());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<pre><code class="java"><span class="function"><span class="keyword">private</span> Animator <span class="title">animateRevealColorFromCoordinates</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>{
    <span class="keyword">float</span> finalRadius = (<span class="keyword">float</span>) Math.hypot(viewRoot.getWidth(), viewRoot.getHeight());

    Animator anim = ViewAnimationUtils.createCircularReveal(viewRoot, x, y, <span class="number">0</span>, finalRadius);
    viewRoot.setBackgroundColor(color);
    anim.start();
}
</code></pre>
<h4 id="u52A8_u753B_u548C_u5C55_u73B0"><a href="#u52A8_u753B_u548C_u5C55_u73B0" class="headerlink" title="动画和展现"></a>动画和展现</h4><p><img src="https://raw.githubusercontent.com/lgvalle/Material-Animations/master/screenshots/reveal_red.gif" alt="reveal_red"></p>
<pre><code class="java">Transition transition = TransitionInflater.from(<span class="keyword">this</span>).inflateTransition(R.transition.changebounds_with_arcmotion);
transition.addListener(<span class="keyword">new</span> Transition.TransitionListener() {
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onTransitionEnd</span><span class="params">(Transition transition)</span> </span>{
        animateRevealColor(bgViewGroup, R.color.red);
    }
    (...)

});
TransitionManager.beginDelayedTransition(bgViewGroup, transition);
RelativeLayout.LayoutParams layoutParams = <span class="keyword">new</span> RelativeLayout.LayoutParams(RelativeLayout.LayoutParams.WRAP_CONTENT, RelativeLayout.LayoutParams.WRAP_CONTENT);
layoutParams.addRule(RelativeLayout.CENTER_IN_PARENT);
btnRed.setLayoutParams(layoutParams);
</code></pre>
<h1 id="Sample_source_code"><a href="#Sample_source_code" class="headerlink" title="Sample source code"></a>Sample source code</h1><p><strong><a href="https://github.com/lgvalle/Material-Animations/" target="_blank" rel="external">https://github.com/lgvalle/Material-Animations</a></strong></p>
<h1 id="More_information"><a href="#More_information" class="headerlink" title="More information"></a>More information</h1><ul>
<li>Alex Lockwood posts about Transition Framework. A great in deep into this topic: <a href="http://www.androiddesignpatterns.com/2014/12/activity-fragment-transitions-in-android-lollipop-part1.html" target="_blank" rel="external">http://www.androiddesignpatterns.com/2014/12/activity-fragment-transitions-in-android-lollipop-part1.html</a></li>
<li>Amazing repository with lot of Material Design samples by Saul Molinero: <a href="https://github.com/saulmm/Android-Material-Examples" target="_blank" rel="external">https://github.com/saulmm/Android-Material-Examples</a></li>
<li>Chet Hasse video explaining Transition framework: <a href="https://www.youtube.com/watch?v=S3H7nJ4QaD8" target="_blank" rel="external">https://www.youtube.com/watch?v=S3H7nJ4QaD8</a></li>
</ul>

      
    </div>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/03/14/how-to-use-vector-drawable/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">VectorDrawable怎么玩</div>
      <strong class="article-nav-caption">></strong>
    </a>
  
</nav>

  
</article>


<div class="share">
	<!-- JiaThis Button BEGIN -->
	<div class="jiathis_style">
		<span class="jiathis_txt">分享到：</span>
		<a class="jiathis_button_tsina"></a>
		<a class="jiathis_button_cqq"></a>
		<a class="jiathis_button_douban"></a>
		<a class="jiathis_button_weixin"></a>
		<a class="jiathis_button_tumblr"></a>
		<a href="http://www.jiathis.com/share" class="jiathis jiathis_txt jtico jtico_jiathis" target="_blank"></a>
	</div>
	<script type="text/javascript" src="http://v3.jiathis.com/code/jia.js?uid=1405949716054953" charset="utf-8"></script>
	<!-- JiaThis Button END -->
</div>



<div class="duoshuo">
	<!-- 多说评论框 start -->
	<div class="ds-thread" data-thread-key="transition-framework" data-title="" data-url="http://yoursite.com/2016/04/04/transition-framework/"></div>
	<!-- 多说评论框 end -->
	<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
	<script type="text/javascript">
	var duoshuoQuery = {short_name:"true"};
	(function() {
		var ds = document.createElement('script');
		ds.type = 'text/javascript';ds.async = true;
		ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
		ds.charset = 'UTF-8';
		(document.getElementsByTagName('head')[0] 
		 || document.getElementsByTagName('body')[0]).appendChild(ds);
	})();
	</script>
	<!-- 多说公共JS代码 end -->
</div>




</div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2016 Damon Zhang
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
    </div>
  </div>
</footer>
    </div>
    
  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">


<script>
	var yiliaConfig = {
		fancybox: true,
		mathjax: true,
		animate: true,
		isHome: false,
		isPost: true,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true
	}
</script>
<script src="http://7.url.cn/edu/jslib/comb/require-2.1.6,jquery-1.9.1.min.js" type="text/javascript"></script>
<script src="/js/main.js" type="text/javascript"></script>






<script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
});

MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for(i=0; i < all.length; i += 1) {
        all[i].SourceElement().parentNode.className += ' has-jax';                 
    }       
});
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  </div>
</body>
</html>